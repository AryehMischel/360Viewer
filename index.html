<html>

<head>
	<meta charset="utf-8" />
	<title>Basic Example — AFrame HTML</title>
	<script>
		// WebXR requires https: to work so ensure redirected if needed.
		if (location.hostname !== 'localhost' && window.location.protocol === 'http:') window.location.protocol = 'https:';
	</script>

	<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
	<meta name="description" content="Basic Example — AFrame HTML" />
	<!-- <style>
		/* body {
			font-size: 16px;
		}

		* {
			box-sizing: border-box;
		}

		#dom-overlay {
			font-family: Sans-Serif;
			color: white;
		}

		#dom-overlay .overlay-footer {
			background: #00000066;
			padding: 1em;
			margin: 0;
			position: absolute;
			inset: auto 0 0 0;
		} */

		
	</style> -->

<style>
	/* Force scrollbars onto browser window */
	body {
	margin-bottom: 200%;
	}
	
	/* Box styles */
	.myBox {
	border: none;
	padding: 5px;
	font: 24px/36px sans-serif;
	width: 200px;
	height: 200px;
	overflow: scroll;
	}
	
	/* Scrollbar styles */
	::-webkit-scrollbar {
	width: 12px;
	height: 12px;
	}
	
	::-webkit-scrollbar-track {
	background: gold;
	border-radius: 10px;
	}
	
	::-webkit-scrollbar-thumb {
	border-radius: 10px;
	background: yellowgreen;  
	}
	
	::-webkit-scrollbar-thumb:hover {
	background: #88ba1c;  
	}
	  .pseudo-item {
	  height: 300px;
	  width: 369px;
	  margin-right: 59px;
	  flex-shrink: 0;
	  background-color: gray;
	}
	  .pseudo-item:nth-of-type(2n) {
	  background-color: lightgray;
	}
	</style>
	<script src="aframe-master.js"></script>
	<script src="./picker.js"></script>
	<script src="./stereo-components.js"></script>
	<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
	<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
	<script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.9/build/handy-controls.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.9/build/magnet-helpers.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
	<script src="build/aframe-html.js"></script>
</head>

<body>
	<a-scene webxr="overlayElement:#dom-overlay;" reflection="directionalLight:#dirlight;"
		renderer="alpha:true;physicallyCorrectLights:true;colorManagement:true;exposure:1;toneMapping:ACESFilmic;"
		gltf-model="dracoDecoderPath: https://cdn.jsdelivr.net/npm/three@0.129.0/examples/js/libs/draco/gltf/;"
		shadow="type: pcfsoft; autoUpdate: true" cursor="rayOrigin: mouse" raycaster="objects: [html]; interval:100;"
		fog="false">
		<a-assets>
			<a-mixin id="blink"
				blink-controls="cameraRig: #cameraRig; teleportOrigin: #head; collisionEntities:.navmesh;"></a-mixin>
			<img id="burgerImg" src="./assets/imgs/burger.jpg">
		</a-assets>
		<!-- <a-sky color="lightblue"></a-sky> -->

		<a-sphere color="black" radius="0.01" id="cursor" material="shader:flat"></a-sphere>

		<a-entity id="cameraRig" spawn-in-circle="radius:3">
			<!-- camera -->
			<a-entity class="avatar-head" camera="near:0.01;" look-controls="pointerLockEnabled: false"
				wasd-controls="acceleration:20;" simple-navmesh-constraint="navmesh:.navmesh;fall:0.5;height:1.65;"
				position="0 1.65 0" stereocam="eye:left;"></a-entity>

			<!-- Hand tracking -->
			<a-entity handy-controls="materialOverride:both;" material="color:gold;metalness:1;roughness:0;">

				<!-- These also do teleportaion for Blink controls in VR -->
				<!-- These are present for hand tracking but hands don't have joysticks so do nothing -->
				<a-entity data-right="ray" mixin="blink" cursor
					raycaster="showLine: true; far: 100; lineColor: red; objects: [html]; interval:100;"></a-entity>
				<a-entity data-left="ray" mixin="blink" cursor
					raycaster="showLine: true; far: 100; lineColor: red; objects: [html]; interval:100;"></a-entity>

				<!-- Use the finger tips for teleporting when the user points in VR with hand tracking -->
				<a-entity data-right="index-finger-tip" mixin="blink"
					blink-controls="startEvents:pose_point;cancelEvents:pose_cancel_point;endEvents:pose_point_fuseLong;">
				</a-entity>
				<a-entity data-left="index-finger-tip" mixin="blink"
					blink-controls="startEvents:pose_point;cancelEvents:pose_cancel_point;endEvents:pose_point_fuseLong;">
				</a-entity>

				<!-- These get drawn towards grabable objects, moving the whole hand and the attached elements-->
				<a-entity id="left-magnet" position="0 0.6 0" class="avatar-hand-left" data-left="grip"
					data-magnet="magnet-left"
					grab-magnet-target="startEvents:squeezestart,pose_fist;stopEvents:pose_flat_fuseShort,squeezeend;noMagnetEl:#left-no-magnet;">
				</a-entity>
				<a-entity id="right-magnet" position="0 0.6 0" class="avatar-hand-right" data-right="grip"
					data-magnet="magnet-right"
					grab-magnet-target="startEvents:squeezestart,pose_fist;stopEvents:pose_flat_fuseShort,squeezeend;noMagnetEl:#right-no-magnet;">
				</a-entity>

				<!-- markers to let us know the real location of the hands, you probably want to make them visible="false" or just make them empty <a-entities> -->
				<a-entity id="left-no-magnet" data-left="grip" data-no-magnet radius="0.01">
					<a-entity html="cursor:#cursor;html:#my-interface" position="-0.142 -0.0166 -0.02928"
						rotation="-80 90 0" scale="0.5 0.5 0.5"></a-entity>
				</a-entity>
				<a-entity id="right-no-magnet" data-right="grip" data-no-magnet radius="0.01"></a-entity>
			</a-entity>
		</a-entity>


		<a-light id="dirlight" shadow-camera-automatic=".navmesh" intensity="0.7"
			light="castShadow:true;type:directional" position="40 80 0"></a-light>
		<a-light type="hemisphere" ground-color="orange" color="blue" intensity="0.5"></a-light>
		<a-circle hide-on-enter-ar shadow="cast:false" class="navmesh" rotation="-90 0 0" radius="6"
			material="shader:phong;color:paleblue;"></a-circle>

		<a-entity id="env" hide-on-enter-ar position="0 -0.2 0"
			environment="lighting:none;preset:yavapai;skyType:atmosphere;" onload="removeSky()">
			<!--  -->
		</a-entity>
		<a-torus-knot position="0 1.5 -1" radius="0.1" radius-tubular="0.02" material="shader:phong;reflectivity:0.3;"
			id="knot"></a-torus-knot>
		<a-entity html="cursor:#cursor;html:#my-interface" shadow position="0.25 1.5 -0.5"></a-entity>
	</a-scene>

	<div id="dom-overlay">
		<section
			style="display: inline-block; background: lavenderblush; color: #333333; border-radius: 1em; padding: 1em; margin:0; accent-color: hotpink;"
			id="my-interface">
			<h2>Application Settings</h2>
			<div class="myBox" id="myBox"></div>


			<button onclick="deleteSky()" style="display: block;">Delete Skies</button>

			<button onclick="handleAuthClick()" style="display: block;">Add photos via google drive</button>

			<button onclick="spawnIcons()" style="display: block;">spawn icon widgets</button>
			<button onclick="AFRAME.scenes[0].exitVR()" style="display: block;">Exit Immersive</button>

			<!-- <div id="image-icons" style="sc"> -->


	</div>





	<script>
		let meshParent = document.getElementById("meshParent")
		let mesh = document.getElementById("htmlMesh");
		var index = 0

		function addMesh() {


			mesh.setAttribute("html", "cursor:#cursor;html:#my-interface")
			mesh.setAttribute("visible", true)


		}

		function removeMesh() {
			mesh.setAttribute("visible", "false")
			mesh.setAttribute("html", "cursor:#;html:#")



		}

		function moveLeft() {
			index++
			select(index)
		}



		function spawnIcons(){
			let myBox = document.getElementById('myBox')
			// let button = document.createElement("button")
			// button.innerHTML = `image${index}`
			// button.setAttribute("onclick", `select(${index})` )
			// myBox.append(button)
			// index++
			
			for(let i = 0; i < arr.length; i++){
					let button = document.createElement("img")
				button.innerHTML = `selectImage${i}`
				button.setAttribute("src", thumbnails[i])
				// button.setAttribute("style", "background-color: green")
				button.setAttribute("onclick", `select(${i})` )
				button.setAttribute("style", "display: block; background-position: center center; height: 50; width: 200;")
				//border-style: solid;border-width: 5px;
				myBox.append(button)
			}
		}
	</script>


	<script>
		//this script processes the images as they come in from gdrive
		let i = 0;
		let arr = [];
		let thumbnails = [];

		const scene = document.querySelector("a-scene")
		const assets = document.querySelector("a-assets")

		function crop(src) {

			let img = document.createElement("img")
			img.setAttribute("src", src)
			img.onload = function () {
				thumbnails.push(img)
				var tempCanvas = document.createElement("canvas")
				var tCtx = tempCanvas.getContext("2d");
				tempCanvas.width = img.width;
				tempCanvas.height = img.height / 2;


				tCtx.drawImage(img, 0, 0);
				var croppedLeft = tempCanvas.toDataURL("image/png");
				tCtx.drawImage(img, 0, -img.height / 2);
				var croppedRight = tempCanvas.toDataURL("image/png");


				let parent = document.createElement("a-entity");
				parent.setAttribute('visible', false)

				let leftSky = document.createElement("a-sky")
				let rightSky = document.createElement("a-sky")

				leftSky.setAttribute("src", croppedLeft)
				leftSky.addEventListener("loaded", () => {
					leftSky.getObject3D("mesh").layers.set(2) // layer 1 is left eye, layer 2 is right 

				})

				rightSky.setAttribute("src", croppedRight)
				rightSky.addEventListener("loaded", () => {
					rightSky.getObject3D("mesh").layers.set(1) // layer 1 is left eye, layer 2 is right 

				})



				parent.append(rightSky)
				parent.append(leftSky)
				scene.append(parent)
				arr.push(parent)
				// spawnIcon()

				//

			};


		}


	</script>


	<script id="skyPicker" defer>


		// Skull on Apple iOS 16.4
		function deleteSky() {


			console.log("removed ski")
			let sky = document.querySelector("a-sky")
			sky.parentNode.removeChild(sky)
		}



		function select(index) {
			arr[i].setAttribute("visible", false)
			arr[index].setAttribute("visible", true)
			i = index;

		}


		$(function () { $("#my-interface").draggable(); });




// function setscene() {
//   numOfElements = arr.length

// }

// async function go() {
//   for (let child of assets.children) {

//   }

// }

	</script>


</body>

</html>

<script>
	$(function () {
		$("#dom-overlay ").draggable();
	});
</script>