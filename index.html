<html>

<head>
	<meta charset="utf-8" />
	<title>Basic Example — AFrame HTML</title>
	<script>
		// WebXR requires https: to work so ensure redirected if needed.
		if (location.hostname !== 'localhost' && window.location.protocol === 'http:') window.location.protocol = 'https:';
	</script>
	<script src="./picker.js"></script>
	<script src="./stereo-components.js"></script>
	<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
	<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

	<meta name="description" content="Basic Example — AFrame HTML" />
	<style>
		body {
			font-size: 16px;
		}

		* {
			box-sizing: border-box;
		}

		#dom-overlay {
			font-family: Sans-Serif;
			color: white;
		}

		#dom-overlay .overlay-footer {
			background: #00000066;
			padding: 1em;
			margin: 0;
			position: absolute;
			inset: auto 0 0 0;
		}
	</style>
	<script src="aframe-master.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.9/build/handy-controls.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/handy-work@3.1.9/build/magnet-helpers.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
	<script src="build/aframe-html.js"></script>
</head>

<body>
	<a-scene webxr="overlayElement:#dom-overlay;" reflection="directionalLight:#dirlight;"
		renderer="alpha:true;physicallyCorrectLights:true;colorManagement:true;exposure:1;toneMapping:ACESFilmic;"
		gltf-model="dracoDecoderPath: https://cdn.jsdelivr.net/npm/three@0.129.0/examples/js/libs/draco/gltf/;"
		shadow="type: pcfsoft" cursor="rayOrigin: mouse" raycaster="objects: [html]; interval:100;">
		<a-assets>
			<a-mixin id="blink"
				blink-controls="cameraRig: #cameraRig; teleportOrigin: #head; collisionEntities:.navmesh;"></a-mixin>
		</a-assets>

		<a-sphere color="black" radius="0.01" id="cursor" material="shader:flat"></a-sphere>


		<a-entity class="avatar-head" wasd-controls="acceleration:20;" position="0 1.6 0">
			<a-entity camera look-controls wasd-controls stereocam="eye:left;"></a-entity>
		  </a-entity>






		<a-entity id="htmlMesh" shadow position="0.25 1.5 -0.5"></a-entity>
		<a-sky color="lightblue"></a-sky>
	</a-scene>

	<div id="dom-overlay">
		<header style="pointer-events: none; user-select: none;">
			<h1>
				My Metaverse Site
			</h1>
		</header>
		<section
			style="display: inline-block; background-color: teal; color: #333333; border-radius: 1em; padding: 1em; margin:0; accent-color: hotpink; "
			id="my-interface">
			<h2>Change Color</h2>
			<img src="./assets/imgs/burger.jpg" height="100" width="100" onload="addMesh()">

			<fieldset style="border:0 none;border-top: 1px solid grey;">
				<legend>Colour</legend>
				<input onclick="handleRadio(this)" type="radio" id="color-red" name="color" value="red" checked><label
					for="color-red"> Red</label>
				<input onclick="handleRadio(this)" type="radio" id="color-blue" name="color" value="blue"><label
					for="color-blue"> Blue</label>
			</fieldset>
			<fieldset style="border-width: 0 1px; border-style: solid;border-radius: 0.5em;">
				<legend>Material:</legend>
				<button style="" id='authorize_button' onclick="handleAuthClick()" name="wireframe"><label
						for="authorize_button"> authorize</label>></button>

				<input onclick="handleCheckbox(this)" id="material-shiny" type="checkbox" name="shiny" checked><label
					for="material-shiny"> Shiny</label>
			</fieldset>
			<fieldset style="border-radius: 1em;">
				<legend>Size:</legend>
				<input oninput="handleRange(this)" type="range" min="0.1" max="2" value="1" step="0.01" id="myRange"
					style="background-color: transparent;">
			</fieldset>
			<button onclick="AFRAME.scenes[0].exitVR()" style="display: block;">Exit Immersive</button>
		</section>
	</div>



	<script>
		let meshParent = document.getElementById("meshParent")
		let mesh = document.getElementById("htmlMesh");

		function addMesh() {


			mesh.setAttribute("html", "cursor:#cursor;html:#my-interface")
			mesh.setAttribute("visible", true)


		}

		function removeMesh() {
			mesh.setAttribute("visible", "false")
			mesh.setAttribute("html", "cursor:#;html:#")



		}

		function handleRadio(detail) {
			const color = detail.value;
			knot.setAttribute('material', 'color', color);
		}
		function handleRange(detail) {
			const size = detail.value;
			knot.object3D.scale.setScalar(size);
		}
		function handleCheckbox(detail) {
			const name = detail.name;
			if (name === 'wireframe') knot.setAttribute('material', 'wireframe', detail.checked);
			if (name === 'shiny') knot.setAttribute('material', 'reflectivity', detail.checked ? '0.3' : 0);
		}
	</script>

	<script>
		//this script processes the images as they come in from gdrive
		let i = 0;
		let arr = [];

		const scene = document.querySelector("a-scene")
		const assets = document.querySelector("a-assets")

		function crop(src) {

			let img = document.createElement("img")
			img.setAttribute("src", src)
			img.onload = function () {

				var tempCanvas = document.createElement("canvas")
				var tCtx = tempCanvas.getContext("2d");
				tempCanvas.width = img.width;
				tempCanvas.height = img.height / 2;


				tCtx.drawImage(img, 0, 0);
				var croppedLeft = tempCanvas.toDataURL("image/png");
				tCtx.drawImage(img, 0, -img.height / 2);
				var croppedRight = tempCanvas.toDataURL("image/png");


				let parent = document.createElement("a-entity");
				parent.setAttribute('visible', false)

				let leftSky = document.createElement("a-sky")
				let rightSky = document.createElement("a-sky")

				leftSky.setAttribute("src", croppedLeft)
				leftSky.addEventListener("loaded", () => {
					leftSky.getObject3D("mesh").layers.set(2) // layer 1 is left eye, layer 2 is right 

				})

				rightSky.setAttribute("src", croppedRight)
				rightSky.addEventListener("loaded", () => {
					rightSky.getObject3D("mesh").layers.set(1) // layer 1 is left eye, layer 2 is right 

				})



				parent.append(rightSky)
				parent.append(leftSky)
				scene.append(parent)
				arr.push(parent)

			};


		}


	</script>


<script id="skyPicker">

	function select(index) {
	  arr[i].setAttribute("visible", false)
	  arr[index].setAttribute("visible", true)
	  i = index;
  
	}
  

	// function setscene() {
	//   numOfElements = arr.length
  
	// }
  
	// async function go() {
	//   for (let child of assets.children) {
  
	//   }
  
	// }
  
  </script>
</body>

</html>